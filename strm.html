<html>
    <head>
        <title>StreamBop Viewer! Select me as a source in OBS!</title>
        <style>
          body {
            user-select: none; /* supported by Chrome and Opera */
            background-color: green;
          }
          
            .gr3  {
                animation: coe 30s infinite;
                background-color: green;
                user-select: none; /* supported by Chrome and Opera */
            }

            .bck1  {
                z-index: -50;
            }

            .emboss-txt  {
                animation: color-change 1s infinite;
            }

            .sus  {
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  overflow: auto;
  background: rgb(255, 255, 255); /* Just to visualize the extent */
}

.working{
        z-index: 9;
        margin: 18px;
        color: black;
    }

    .working3{
        z-index: 109;
        margin: 18px;
        color: black;
    }


            @keyframes color-change {
  0% { color: red; }
  50% { color: blue; }
  100% { color: red; }
}

@keyframes coe  {
  0% { background-color: red; }
  50% { background-color: blue; }
  100% { background-color: red; }
}

body::-webkit-scrollbar {
    display: none; /* for Chrome, Safari, and Opera */
}

.waiting  {
  position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

.working  {
  position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

.working3  {
  position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

.body  {
  position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

.box{
        width: 90%;
        height: 90%;            
        position: absolute;
        top: 0;
        left: 0;
    }

.bock{
    width: 100%;
    height: 100%;
    position: relative;
    top: 0;
    background-color: green;
    left: 0;
    z-index: 100;
}

.setup{
    width: 100%;
    height: 100%;
    position: relative;
    top: 0;
    background-color: green;
    left: 0;
    z-index: 100;
}
    </style>
      <script>
        window.jQuery = window.$ = require('jquery');
        const axios = require('axios')
    </script>
      <link rel="stylesheet" href="https://cdn.snaildos.com/w3.css">
      <link rel="stylesheet" href="https://cdn.snaildos.com/bootstrap.min.css">
      <script src="https://cdn.snaildos.com/bootstrap.min.js"></script>
      <script src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js'></script>
        <script>
const Store = require('electron-store');

const config = new Store();
</script>
<script>
  config.set('oldVariable', "test")
  config.set('testVariable', "kk")
</script>
<script>
function timeout(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

            function Minimize()
{
window.innerWidth = 100;
window.innerHeight = 100;
window.screenX = screen.width;
window.screenY = screen.height;
alwaysLowered = true;
}

function checkStart() {
    if(config.get('on') == true) {
       console.log("ok time to wake up, we are ready.")
       $( "#g33" ).removeClass( "gr3" )
       $('.bck1').slideDown(1000)
       $('.waiting').slideUp(1000)
       $(".1").hide()
       $(".err").hide()
       $(".bock").show()
       $('.bck1').slideUp(1000)
       $('.working').slideUp(1000)
    async function nots() {
    await timeout(25000);
    console.log("Start.")
    await noti()
    await timeout(5000);
    }
    nots()
  } else {
      console.log("Waiting for thumbs up... I am bored...")
      window.setTimeout(checkStart, 100); /* this checks the flag every 100 milliseconds*/
    }
}
checkStart();



function checkAlwaysOn() {
  if(config.get('alwayson')) {
  $('.bck1').slideDown(1000)
  $('.working').slideDown(1000)
      window.setTimeout(checkAlwaysOn, 2000); /* this checks the flag every 100 milliseconds*/
    } else {
      console.log("Not required...")
      window.setTimeout(checkAlwaysOn, 2000); /* this checks the flag every 100 milliseconds*/
    }
}
checkAlwaysOn();

function noti()  {
  $('.bck1').slideDown(1000)
  $('.working').slideDown(1000)
  setTimeout(function(){
    $('.bck1').slideUp(1000)
    $('.working').slideUp(1000)
    }, 10000);
}

function checkStop() {
    if(config.get('on') == false) {
        console.log("Service stopped.")
        $( "#g33" ).addClass( "gr3" )
        $('.waiting').slideDown(1000)
        $('.bck1').slideUp(1000)
        $(".1").show()
        $(".err").show()
        $(".bock").hide()
      window.setTimeout(checkStop, 100); /* this checks the flag every 100 milliseconds*/
        checkStart()
        $('.bck1').slideUp(1000)
        $('.working').slideUp(1000)
    } else {
      console.log("stop prot waiting...")
      window.setTimeout(checkStop, 100); /* this checks the flag every 100 milliseconds*/
    }
}
checkStop();

function checkSetup() {
    if(config.get('setupan') == true) {
      $( "#g33" ).removeClass( "gr3" )
       $('.bck1').slideDown(1000)
       $('.waiting').slideUp(1000)
       $(".1").hide()
       $(".err").hide()
       $('.bck1').slideUp(1000)
       $('.working').slideUp(1000)
      $('.setup').slideDown(100)
    } else {
      console.log("No setup event...")
      window.setTimeout(checkSetup, 100); /* this checks the flag every 100 milliseconds*/
    }
}
checkSetup();


setTimeout(function(){
  $('.sus').slideUp(100)
        $('.bck1').slideUp(100)
        $('.setup').slideUp(100)
        $(".bock").hide()
        $("#fireset").hide()
        $("#erset").hide()
        $("#blueset").hide()
},800);

setInterval(()=>{
  if (config.get("alwayson")) {
    console.log("We won't check, since we are always on!")
  } else {
  console.log("Checking!")
  var np3 = config.get('song');

  config.set('testVariable', config.get('song'));
  if (config.get('testVariable') == config.get('oldVariable')) {
  console.log("Waiting for change..")
} else {
  config.set('testVariable', config.get('song'));
  config.set('oldVariable', config.get('song'));
  noti()
}
  console.log(np3)
  document.getElementById('npvs').innerText = np3 || 'Error.'
}
},500);

setInterval(()=>{
  var npv3 = config.get('name')
  console.log(npv3)
  console.log(config.get('oldVariable') + ' ' + config.get('testVariable'));
  document.getElementById('np').innerText = npv3 || 'FTCHING...'
  },100);
        </script>
    </head>
<body>
  <div id="sus" class="sus"><h1>Page loading...</h1></div>
<div id="g33" class="gr3">
    <div id="waiting" class="waiting">
    <h1>Welcome to StreamBop viewer</h1>
    <h1>This should only be visible on OBS, if you see this...</h1>
    <h2><b>ITS NOT YOUR CONTORL PANEL.</b> Please move this window away, DO NOT minimize it or close it, just move it away. :)</h2>
    <h2>Once done, go to the control panel and press "Start"!</h2>
    <h1>Waiting for start button to be pressed...</h1>
    </div>
<div class="bock">
    <div id="bck1" class="box bck1">
      <object class="" data="./svg/fire.svg" id="fireset"></object>
      <object class="" data="./svg/er.svg" id="erset"></object>
      <object class="" data="./svg/h.svg" id="blueset"></object>
    </div>
    <div id="working" class="box working">
    <h1 class="w3-center emboss-txt 1" id="1">Loading Info...</h1>
    <p>.</p>
    <h2 class="w3-center">You are watching:</h2>
    <h2 class="w3-center np" id="np">PS.L</h2>
    <h2 class="w3-center npvs" id="npvs">SONG N/A</h2>
    <h3 class="w3-center">Stream Bop</h3>
    <h1 class="w3-center err" id="err"> ERROR LOADING INFO BELOW </h1>
    </div>
</div>
</div>

<div class="setup">
  <div id="bck3" class="box bck3">
    
  </div>
  <div id="working3" class="working3">
  <p>.</p>
  <h2 class="w3-center">You are watching:</h2>
  <h2 class="w3-center" id="">Setup Mode</h2>
  <h2 class="w3-center" id="">Position this in OBS.</h2>
  <h3 class="w3-center">Stream Bop</h3>
  </div>
</div>
</div>
</body>
<script>
setTimeout(function(){
  // Onload, we need to see what theme the user wants...
if(config.get('theme') == "fire") {
$("#fireset").show()
("#fireset").addClass("fire");
} else {
if(config.get('theme') == "blue") {
$("#blueset").show()
("#blueset").addClass("fire");
} else {
$("#erset").show()
("#erset").addClass("fire");
  alert("Fetch Error! Your streambop instance is corrupted! Please reinstall!")
}}
}, 1000)
</script>
</html>